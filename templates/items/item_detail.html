{% extends "base.html" %}
{% block content %}

<div class="detail-card">
  <!-- PRODUCT IMAGE -->
  <img src="{{ url_for('static', filename='uploads/' + item.image) }}"
       onerror="this.src='https://via.placeholder.com/600x400'">

  <div class="detail-info">
    <h2>{{ item.name }}</h2>
    <p>{{ item.description }}</p>
    <h3>₹{{ item.rate_per_day }} / day</h3>

    <!-- AVAILABILITY SECTION -->
    {% if available <= 0 %}
      <div class="out-stock-box">
        <h3>❌ Out of Stock</h3>
        <p>Next available on <b>{{ next_available }}</b></p>
      </div>
    {% else %}
      <p class="in-stock">
        Available units: {{ available }}
      </p>

      <!-- BOOKING FORM -->
      <form method="POST" action="/fake-payment/{{ item.id }}" onsubmit="return calculatePrice()">
        <label>Start Date</label>
        <input type="date" name="start_date" id="start" required>

        <label>End Date</label>
        <input type="date" name="end_date" id="end" required>

        <p id="price" class="price-text"></p>

        <button class="btn">Proceed to Pay</button>
      </form>
    {% endif %}
  </div>
</div>

<!-- ---------------- REVIEWS ---------------- -->
<hr>
<h2>Customer Reviews</h2>

{% if reviews %}
  {% for r in reviews %}
    <div class="order-card">
      <p><strong>⭐ {{ r.rating }}/5</strong></p>
      <p>{{ r.comment }}</p>

      {% if r.image %}
        <img src="{{ url_for('static', filename='uploads/' + r.image) }}"
             style="max-width: 200px; border-radius: 8px;">
      {% endif %}
    </div>
  {% endfor %}
{% else %}
  <p>No reviews yet for this product.</p>
{% endif %}

<!-- ---------------- PRICE CALCULATION SCRIPT ---------------- -->
<script>
function calculatePrice() {
  const start = new Date(document.getElementById("start").value);
  const end = new Date(document.getElementById("end").value);

  if (end <= start) {
    alert("End date must be after start date");
    return false;
  }

  const days = (end - start) / (1000 * 60 * 60 * 24);
  const rate = {{ item.rate_per_day }};
  const total = days * rate;

  document.getElementById("price").innerText =
    "Total Amount: ₹" + total;

  return true;
}
</script>

{% endblock %}
